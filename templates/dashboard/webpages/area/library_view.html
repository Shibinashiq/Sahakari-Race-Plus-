<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
	  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
		integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
	  integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
		crossorigin="anonymous"></script>
<div id="map" style="height: 90vh;width:100%;"></div>
<div class="container d-flex justify-content-between align-items-center">
	<div class="row d-flex text-center">
		Area Name: {{ area_name }}
	</div>
    <div class="row">
		<button class="btn btn-sm btn-outline-primary" onclick="goBack()">Go Back</button>
        <a class="btn btn-sm btn-success" href="{% url 'salesman-area-library-import' id %}">Import</a>
	</div>

	
</div>
<script>
    function goBack() {
        window.history.back();
    }
</script>



<script>
    var areaData = `{{ area|safe }}`;

    function convertToCoordinates(areaData) {
        var coordinates = [];

        var startIndex = areaData.indexOf("((") + 2;
        var endIndex = areaData.indexOf("))");
        var coordinatesStr = areaData.substring(startIndex, endIndex);

        var points = coordinatesStr.split(", ");

        for (var i = 0; i < points.length; i++) {
            var point = points[i].split(" ");
            var longitude = parseFloat(point[0]);
            var latitude = parseFloat(point[1]);

            if (!isNaN(latitude) && !isNaN(longitude)) {
                coordinates.push([latitude, longitude]);
            } else {
                console.error("Invalid latitude or longitude:", latitude, longitude);
            }
        }

        coordinates.push(coordinates[0]);

        return coordinates;
    }

    var coordinates = convertToCoordinates(areaData);

    console.log(coordinates);

    function initMap() {
        var areaData = `{{ area|safe }}`;
        var map = L.map('map').setView([{{ area.centroid.y }}, {{ area.centroid.x }}], 12);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        var coordinates = convertToCoordinates(areaData);

        console.log("coordinates -> "+coordinates)

        if (coordinates.length > 0) {
            var regionPolygon = L.polygon(coordinates, {
                color: 'blue', 
                weight: 2,
                fillColor: 'blue', 
                fillOpacity: 0.35
            }).addTo(map);

            map.fitBounds(regionPolygon.getBounds());
        }
    }

    initMap();
</script>
