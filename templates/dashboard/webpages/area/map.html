{% extends 'dashboard/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}

{% block css %}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css">
    <link href="{% static 'dashboard/assets/libs/sweetalert2/sweetalert2.min.css' %}" rel="stylesheet" type="text/css"/>
    <link href="{% static 'dashboard/assets/libs/swiper/swiper-bundle.min.css' %}" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
{% endblock css %}

{% block style %}

    <style>
 #alert-box-top-right {
        position: absolute;
        top: 5%;
        right: 5%;
        transform: translate(5%, -5%);
    }
    .border-red {
        border: 1px solid #ff0000;
    }
    
    
    </style>
    
    {% endblock style %}

{% block content %}
<div class="page-content">
    <div class="container-fluid">
        <div id="map" class="map-container" style="height: 79vh; width: 100%;"></div>
        <div class="container mt-3 d-flex justify-content-between align-items-center">
            <div class="row text-center">
                <div class="col">
                    <!-- <strong>Area Name:</strong> {{ area_name }} -->
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <button class="btn btn-sm btn-outline-primary" onclick="goBack()">
                        <i class="fas fa-arrow-left"></i> Go Back
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="pagination">
    {% if object_list.has_previous %}
        <a href="?page=1">&laquo; First</a>
        <a href="?page={{ object_list.previous_page_number }}">Previous</a>
    {% endif %}
    <span class="current">
        Page {{ object_list.number }} of {{ object_list.paginator.num_pages }}.
    </span>
    {% if object_list.has_next %}
        <a href="?page={{ object_list.next_page_number }}">Next</a>
        <a href="?page={{ object_list.paginator.num_pages }}">Last &raquo;</a>
    {% endif %}
</div>
{% endblock content %}

{% block js %}
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    
    <script>
        function goBack() {
            window.history.back();
        }
    </script>
    <script>
        var map = L.map('map').setView([25.4052, 55.5136], 15); 

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var editableLayers = new L.FeatureGroup();
        map.addLayer(editableLayers);

        var drawControl = new L.Control.Draw({
            position: 'topright',
            draw: false 
        });

        

        map.on('draw:created', function (e) {
            var type = e.layerType,
                layer = e.layer;

            if (type === 'polygon') {
                layer.bindPopup('A polygon!');
            }

            editableLayers.addLayer(layer);
        });

        fetch('/salesman/get_polygons/')
            .then(response => response.json())
            .then(data => {
                data.features.forEach(feature => {
                    const coordinates = feature.geometry.coordinates[0];
                    console.log(`Feature ID: ${feature.properties.id}, Name: ${feature.properties.name}`);
                    coordinates.forEach(coord => {
                        console.log(`Longitude: ${coord[0]}, Latitude: ${coord[1]}`);
                        const polygonPoints = coord.map(point => [point[1], point[0]]);
                        const polygon = L.polygon(polygonPoints).addTo(map);
                        polygon.bindPopup(` Area Name: ${feature.properties.name}`);
                    });
                });
            })
            .catch(error => console.error('Error fetching GeoJSON data:', error));
    </script>
    <script>
        $(document).ready(function () {
            $('.noty-tost').click();
        });
    </script>
    
    
{% endblock js %}
